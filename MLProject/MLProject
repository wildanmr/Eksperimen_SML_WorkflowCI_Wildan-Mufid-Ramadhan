name: diabetes-prediction-ci

conda_env: conda.yaml

entry_points:
  main:
    parameters:
      data_path: {type: string, default: "diabetes_preprocessed.csv"}
      use_dagshub: {type: bool, default: true}
      experiment_name: {type: string, default: "CI_Auto_Training"}
      model_name: {type: string, default: "diabetes_rf_model"}
      max_depth: {type: int, default: 20}
      n_estimators: {type: int, default: 200}
      min_samples_split: {type: int, default: 5}
      min_samples_leaf: {type: int, default: 2}
    command: "python modelling.py --data_path {data_path} --use_dagshub {use_dagshub} --experiment_name {experiment_name} --model_name {model_name} --max_depth {max_depth} --n_estimators {n_estimators} --min_samples_split {min_samples_split} --min_samples_leaf {min_samples_leaf}"

  train:
    parameters:
      data_path: {type: string, default: "diabetes_preprocessed.csv"}
      use_dagshub: {type: bool, default: true}
      experiment_name: {type: string, default: "CI_Training"}
    command: "python modelling.py --data_path {data_path} --use_dagshub {use_dagshub} --experiment_name {experiment_name}"

  build_docker:
    parameters:
      model_uri: {type: string}
      image_name: {type: string, default: "diabetes-prediction-model"}
    command: "mlflow models build-docker -m {model_uri} -n {image_name} --enable-mlserver"

docker_env:
  image: "python:3.9-slim"